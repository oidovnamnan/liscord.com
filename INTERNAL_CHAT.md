# 💬 LISCORD — БИЗНЕС ДОТООД ЧАТ & МЭДЭЭЛЭЛ СОЛИЛЦОО

> **Зарчим:** Бизнесийн баг нэг дор — захиалгын талаар ярилцах, зураг явуулах,
> даалгавар өгөх, чухал мэдээлэл хуваалцах. Бүгд нэг платформ дотор.
> Telegram/Messenger руу шилжихгүй.

---

## 1. ЧАТЫН ТӨРЛҮҮД

```
💬 Бизнес дотоод чат
│
├── 📢 Сувгууд (Channels)
│   ├── #ерөнхий          — Бүх ажилтан, ерөнхий чат
│   ├── #захиалга          — Захиалгын мэдэгдэл, ярилцлага
│   ├── #нөөц             — Бараа, нөөцийн мэдээлэл
│   ├── #хүргэлт          — Хүргэлтийн баг
│   ├── #санхүү            — Төлбөр, тооцоо
│   └── #тусгай_суваг     — Эзэн өөрөө үүсгэж болно
│
├── 👤 Хувийн мессеж (DM)
│   └── Ажилтан ↔ Ажилтан
│
└── 📋 Захиалгын чат (Order Chat)
    └── Тухайн захиалгатай холбоотой ярилцлага
        → Захиалгын дэлгэрэнгүй хуудсанд
```

---

## 2. 📢 СУВГУУД (Channels)

### 2.1 Анхдагч сувгууд

| # | Суваг | Хэн хардаг | Тайлбар |
|---|-------|-----------|---------|
| 1 | `#ерөнхий` | Бүх ажилтан | Нийтлэг мэдэгдэл, ярилцлага |
| 2 | `#захиалга` | orders.view_* эрхтэй | Шинэ захиалга, статус, төлбөр |
| 3 | `#нөөц` | products.view эрхтэй | Нөөц бага, шинэ бараа |
| 4 | `#санхүү` | finance.view_* эрхтэй | Төлбөр, авлага, тооцоо |
| 5 | `#зарлал` | Бүгд уншина, эзэн/менежер бичнэ | Чухал зарлал (read-only ажилтанд) |

### 2.2 Custom суваг (Эзэн үүсгэнэ)

```
┌──────────────────────────────────────────┐
│  ➕ Шинэ суваг үүсгэх                   │
│                                          │
│  Нэр: [#хүргэлтийн_баг     ]            │
│  Тайлбар: [Хүргэлтийн ажилтнуудын чат]  │
│                                          │
│  Төрөл:                                  │
│  (●) Нээлттэй — бүхийл ажилтан орно     │
│  ( ) Хязгаартай — зөвхөн сонгосон хүмүүс│
│  ( ) Зарлал — зөвхөн эзэн/менежер бичнэ │
│                                          │
│  Гишүүд: (хязгаартай бол)                │
│  ☑ Дорж (Менежер)                        │
│  ☑ Оюуна (Хүргэгч)                      │
│  ☑ Баатар (Хүргэгч)                     │
│  ☐ Сараа (Нярав)                         │
│                                          │
│  [    Үүсгэх    ]                        │
└──────────────────────────────────────────┘
```

---

## 3. 💬 МЕССЕЖИЙН ТӨРЛҮҮД

### 3.1 Илгээж болох зүйлс

| # | Төрөл | Icon | Жишээ |
|---|-------|------|-------|
| 1 | Текст | 💬 | "Болдын захиалга бэлэн боллоо" |
| 2 | Зураг | 📸 | Барааны зураг, баримтын зураг |
| 3 | Дуут мессеж | 🎤 | Товч аудио бичлэг |
| 4 | Файл | 📎 | PDF, Excel, баримт |
| 5 | Захиалга линк | 📋 | #ORD-0042 → дарахад дэлгэрэнгүй нээгдэнэ |
| 6 | Харилцагч линк | 👤 | @Болд → дарахад харилцагч нээгдэнэ |
| 7 | Бараа линк | 🛍️ | [iPhone 15 Pro] → дарахад бараа нээгдэнэ |
| 8 | Байршил | 📍 | Хүргэлтийн хаяг, газрын зураг |
| 9 | Даалгавар | ✅ | Хуваарилагдсан даалгавар (checkbox) |
| 10 | Санал асуулга | 📊 | Ажилтнуудаас санал авах |

### 3.2 Мессежийн тусгай боломжууд

```
📌 Pin — Чухал мессежийг pin хийх (дээр байнга харагдана)
💬 Reply — Тодорхой мессежид хариулах (thread)
😀 Reaction — Emoji reaction (👍 ✅ 👎 ❤️ 😂 🔥)
🔗 Forward — Мессежийг өөр суваг/хүнд дамжуулах
📋 Copy — Текст хуулах
🗑️ Delete — Өөрийн мессежийг устгах (хугацаатай)
✏️ Edit — Өөрийн мессежийг засах (5 минутын дотор)
```

---

## 4. 📋 ЗАХИАЛГЫН ЧАТ (Order Chat)

### 4.1 Ойлголт

Захиалга бүрт **тусдаа чат** байна. Тухайн захиалгатай холбоотой бүх ярилцлага нэг дор.

```
┌──────────────────────────────────────────┐
│  📋 #ORD-0042 • Болд • ₮8,555,000      │
│  Статус: 🟡 Бэлтгэж буй                │
│                                          │
│  [Мэдээлэл] [Бараа] [Төлбөр] [💬 Чат]  │
│                                          │
│  ── Чат ─────────────────────────────── │
│                                          │
│  📌 Pinned: "Энэ захиалга яаралтай,     │
│  өнөөдөр заавал бэлэн болно! —Бат"      │
│                                          │
│  Бат (Эзэн)                    09:15    │
│  Болдын iPhone 2-ыг бэлтгэнэ үү.       │
│  Хар өнгөтэй байх ёстой.               │
│                                          │
│  Сараа (Нярав)                  09:20    │
│  Хар нь зөвхөн 1 ширхэг үлдсэн.        │
│  Мөнгөлөг 1 байна. Яах вэ?             │
│                                          │
│  Бат (Эзэн)                    09:22    │
│  Харилцагчаас асууя.                    │
│  📞 Болд руу залгасан.                   │
│                                          │
│  Бат (Эзэн)                    09:35    │
│  ✅ Болд мөнгөлөг авна гэлээ.           │
│  Сараа, бэлтгэнэ үү.                   │
│                                          │
│  Сараа (Нярав)                  09:40    │
│  [📸 Зураг: Баглаасан бараа]            │
│  Бэлэн болсон ✅                        │
│                                          │
│  🤖 Систем                      09:40    │
│  Сараа статус "Бэлэн" болгосон          │
│                                          │
│  Дорж (Менежер)                 10:00    │
│  Хүргэлт захиаллаа. Жолооч Оюуна       │
│  авч явна. ~30 мин.                     │
│                                          │
│  ─── Бичих ──────────────────────────── │
│  [📎] [📸] [🎤] [Бичих...        ] [➤] │
└──────────────────────────────────────────┘
```

### 4.2 Автомат мессеж (Системийн)

Захиалгын чатанд систем автомат мессеж бичнэ:

| Триггер | Автомат мессеж |
|---------|---------------|
| Статус өөрчлөгдсөн | "🤖 Дорж статус **Шинэ → Баталсан** болгосон" |
| Төлбөр бүртгэгдсэн | "🤖 Бат **₮5,000,000** төлбөр бүртгэсэн (Хаан банк)" |
| Ажилтан хуваарилсан | "🤖 Бат захиалгыг **Дорж**-д оноосон" |
| Хөнгөлөлт | "🤖 Дорж **5% хөнгөлөлт** олгосон" |
| Буцаалт | "🤖 Дорж **₮4,500,000** буцаалт хийсэн" |
| Бараа засасан | "🤖 Сараа бараа нэмсэн: Galaxy S24 x1" |
| Хүргэлт захиалсан | "🤖 B2B: Хүргэлт хүсэлт — Хурдан Хүргэлт" |

---

## 5. ✅ ДААЛГАВАР (Tasks)

### 5.1 Даалгавар чатаар

```
Бат (Эзэн)                       14:00
✅ Даалгавар:
  ☐ Болдын захиалга бэлтгэх → @Сараа
  ☐ Хүргэлт товлох → @Дорж
  ☐ 5 ширхэг iPhone нэмэлт захиалах → @Сараа
  
  Хугацаа: Өнөөдөр 17:00 хүртэл
```

```javascript
// Firestore: businesses/{bizId}/tasks/{taskId}
{
  id: "task_abc",
  channelId: "ch_general",              // Аль сувагт
  messageId: "msg_xyz",                  // Аль мессежтэй холбоотой
  orderId: "ord_xyz",                    // Захиалгатай холбоос (optional)
  
  title: "Болдын захиалга бэлтгэх",
  description: "",
  
  assignedTo: "user_sara",
  assignedToName: "Сараа",
  
  status: "pending",                     // "pending" | "in_progress" | "completed"
  priority: "high",
  deadline: Timestamp,
  
  createdBy: "user_bat",
  createdAt: Timestamp,
  completedAt: null,
}
```

---

## 6. 🔔 ЧАТ МЭДЭГДЭЛ

### 6.1 Мэдэгдлийн тохиргоо

```
Суваг бүрт тусдаа тохируулна:
┌────────────────────────────────────┐
│ #захиалга — Мэдэгдлийн тохиргоо   │
│                                    │
│ ( ) Бүгд — Бүх мессеж             │
│ (●) Mention — Зөвхөн @нэр дурдсанд│
│ ( ) Юу ч үгүй — Чимээгүй         │
│                                    │
│ Push мэдэгдэл:  [████░░] ON       │
│ Дуут мэдэгдэл:  [░░░░░░] OFF      │
└────────────────────────────────────┘
```

### 6.2 @mention систем

```
@Дорж          → Тухайн хүнд мэдэгдэл
@менежер       → Тухайн тушаалтай бүгдэд
@бүгд          → Сувгийн бүх гишүүнд
@хүргэгч       → Хүргэгч тушаалтай бүгдэд
```

---

## 7. 🗄️ МЭДЭЭЛЛИЙН БҮТЭЦ

### 7.1 Сувгууд

```javascript
// Firestore: businesses/{bizId}/channels/{channelId}
{
  id: "ch_general",
  name: "ерөнхий",
  description: "Бүх ажилтан",
  type: "public",                        // "public" | "private" | "announcement"
  
  isDefault: true,                       // Бүгд автомат нэгдэнэ
  isSystem: true,                        // Устгаж болохгүй
  
  members: [],                           // private бол member жагсаалт
  
  // Сүүлийн мессеж (preview)
  lastMessage: {
    text: "Бэлэн болсон ✅",
    senderName: "Сараа",
    sentAt: Timestamp,
  },
  
  pinnedMessages: [],
  
  createdBy: "user_bat",
  createdAt: Timestamp,
}
```

### 7.2 Мессеж

```javascript
// Firestore: businesses/{bizId}/channels/{channelId}/messages/{msgId}
{
  id: "msg_abc",
  
  // Илгээгч
  sender: {
    userId: "user_sara",
    name: "Сараа",
    position: "Нярав",
    avatar: "url",
  },
  
  // Агуулга
  type: "text",                          // "text" | "image" | "voice" | "file" | "system" | "task" | "poll" | "order_link"
  
  text: "Бэлэн болсон ✅",
  
  // Хавсралт (type-аас хамаарна)
  attachments: [
    // { type: "image", url: "...", thumbnail: "...", size: 245000 }
    // { type: "file", url: "...", name: "report.pdf", size: 1200000 }
    // { type: "voice", url: "...", duration: 15 }
  ],
  
  // Холбоосууд
  links: {
    orderId: "ord_xyz",                  // Захиалга руу линк
    orderNumber: "#ORD-0042",
    customerId: null,
    productId: null,
  },
  
  // Reply
  replyTo: {
    messageId: "msg_prev",
    senderName: "Бат",
    text: "Хар өнгөтэй байх ёстой.",    // Preview
  },
  
  // Mention
  mentions: ["user_dorj"],               // @mention хийсэн хүмүүс
  mentionAll: false,                     // @бүгд
  
  // Reactions
  reactions: {
    "👍": ["user_bat", "user_dorj"],
    "✅": ["user_bat"],
  },
  
  // Мета
  isPinned: false,
  isEdited: false,
  editedAt: null,
  isDeleted: false,
  
  createdAt: Timestamp,
}
// Хэмжээ: ~0.5-1KB/doc
```

### 7.3 Захиалгын чат

```javascript
// Firestore: businesses/{bizId}/orders/{orderId}/chat/{msgId}
// Мессежийн бүтэц дээрхтэй адил (7.2)
// Ялгаа: Тухайн захиалгын subcollection дотор
```

### 7.4 Хувийн мессеж (DM)

```javascript
// Firestore: businesses/{bizId}/directMessages/{conversationId}/messages/{msgId}
// conversationId = sorted([userId1, userId2]).join('_')
// Жишээ: "user_bat_user_dorj"
```

---

## 8. ⚡ REAL-TIME

```javascript
// Чат = real-time listener
// Суваг бүрт listener ажиллана

onSnapshot(
  query(
    collection(db, `businesses/${bizId}/channels/${channelId}/messages`),
    orderBy("createdAt", "desc"),
    limit(50)                            // Сүүлийн 50 мессеж
  ),
  (snapshot) => {
    snapshot.docChanges().forEach((change) => {
      if (change.type === "added") {
        // Шинэ мессеж → UI-д нэмэх + мэдэгдэл
      }
      if (change.type === "modified") {
        // Reaction нэмэгдсэн / Edit хийсэн
      }
    });
  }
);
```

---

## 9. 🔍 ХАЙЛТ

```
┌──────────────────────────────────────────┐
│ 🔍 Чатаас хайх                          │
│ [iPhone хэзээ ирэх вэ?              🔍] │
│                                          │
│ Шүүлт: [Бүгд▾] [Зураг] [Файл] [Линк]  │
│ Суваг: [Бүгд▾]  Хэн: [Бүгд▾]          │
│                                          │
│ ── Үр дүн (3) ──────────────────────── │
│                                          │
│ #захиалга • Дорж • 02.18                │
│ "iPhone хэзээ ирэх вэ гэж асуулаа..."  │
│                                          │
│ #ORD-0042 чат • Сараа • 02.20           │
│ "iPhone хар 1, мөнгөлөг 1 үлдсэн"     │
│                                          │
│ #ерөнхий • Бат • 02.21                  │
│ "iPhone 15 Pro шинэ batch ирлээ"        │
└──────────────────────────────────────────┘
```

---

## 10. 📱 UI LAYOUT

```
Desktop:
┌────┬───────────────┬─────────────────────┐
│Side│  Сувгууд      │  Мессежүүд          │
│bar │               │                     │
│    │ 📢 #ерөнхий 3 │  Бат        09:15  │
│    │ 📋 #захиалга  │  Бэлтгэнэ үү       │
│    │ 📦 #нөөц     │                     │
│    │ 💰 #санхүү    │  Сараа      09:20  │
│    │ 📢 #зарлал    │  Хар 1 үлдсэн      │
│    │               │                     │
│    │ ── DM ──     │  ...                 │
│    │ 👤 Дорж 🟢   │                     │
│    │ 👤 Сараа 🟡  │  ───────────────    │
│    │ 👤 Оюуна ⚫  │  [📎][📸][🎤][  ] ➤│
│    │               │                     │
└────┴───────────────┴─────────────────────┘

Mobile:
┌──────────────────┐    ┌──────────────────┐
│ 💬 Чат           │    │ ← #ерөнхий       │
│                  │    │                  │
│ 📢 #ерөнхий   3 │ →  │ Бат      09:15  │
│ 📋 #захиалга    │    │ Бэлтгэнэ үү     │
│ 📦 #нөөц       │    │                  │
│                  │    │ Сараа    09:20  │
│ ── DM ──        │    │ Хар 1 үлдсэн   │
│ 👤 Дорж 🟢      │    │                  │
│ 👤 Сараа 🟡    │    │ ──────────────  │
│                  │    │ [📎][📸][ ] ➤  │
└──────────────────┘    └──────────────────┘
```

---

## 11. 🔑 ЭРХҮҮД

| ID | Нэр | Тайлбар |
|----|-----|---------|
| `chat.view` | Чат харах | Сувгууд, мессеж |
| `chat.send` | Мессеж бичих | Текст, зураг, файл |
| `chat.manage_channels` | Суваг удирдах | CRUD, гишүүд |
| `chat.pin_messages` | Pin хийх | Чухал мессеж pin |
| `chat.delete_others` | Бусдын мессеж устгах | Модератор |
| `chat.create_tasks` | Даалгавар үүсгэх | Ажилтанд даалгавар |

---

## 12. FEATURE TOGGLE

```javascript
features: {
  chat:              true,     // Чат систем on/off
  orderChat:         true,     // Захиалгын чат
  directMessages:    true,     // Хувийн мессеж
  voiceMessages:     true,     // Дуут мессеж
  chatTasks:         true,     // Даалгавар
  chatPolls:         false,    // Санал асуулга
  chatFileSharing:   true,     // Файл хуваалцах
}
```

---

*Энэ модуль нь Telegram/Messenger-гүйгээр багийн харилцааг Liscord дотор шийднэ.*
