# 🚚 LISCORD — ХҮРГЭЛТ УДИРДЛАГЫН МОДУЛЬ (Delivery)

> **Зарчим:** Захиалга → Хүргэгч оноо → Хүргэлтийн явц → Баталгаа.

---

## 1. БҮТЭЦ

```
Хүргэлт Удирдлага
├── 👤 Хүргэгч удирдлага (Driver Management)
├── 📋 Хүргэлт хуваарилах (Assignment)
├── 🗺️ Хүргэлтийн бүс/маршрут (Zones)
├── 📍 Хүргэлтийн явц (Tracking)
├── ✅ Хүргэлтийн баталгаа (Proof of Delivery)
├── 💰 Хүргэлтийн төлбөр (Fee Calculation)
└── 📊 Тайлан (Reports)
```

---

## 2. ХҮРГЭГЧ УДИРДЛАГА

```javascript
// Хүргэгч = businesses/{bizId}/employees/{empId} (position: "Хүргэгч")
// Нэмэлт талбарууд:
{
  deliveryProfile: {
    vehicleType: "car",         // "car" | "motorcycle" | "bicycle" | "walking"
    vehiclePlate: "1234 УНА",
    maxCapacity: 20,            // Нэг удаад хэдэн захиалга авч чадах
    currentLoad: 3,             // Одоо авсан тоо
    isAvailable: true,          // Хүргэлтэнд бэлэн юу
    currentLocation: null,      // GPS координат (ирээдүйд)
  }
}
```

---

## 3. ХҮРГЭЛТИЙН БҮРТГЭЛ

```javascript
// businesses/{bizId}/deliveries/{deliveryId}
{
  id: "del_abc",
  orderId: "ord_xyz",
  orderNumber: "ORD-0042",
  
  // Харилцагч
  customerName: "Болд",
  customerPhone: "+97688001234",
  deliveryAddress: "БЗД, 3-р хороо, 45-р байр, 301 тоот",
  deliveryDistrict: "БЗД",
  deliveryCoords: null,       // { lat, lng } — ирээдүйд
  
  // Хүргэгч
  driverId: "emp_driver1",
  driverName: "Түмэн",
  driverPhone: "+97699887766",
  
  // Статус
  status: "assigned",
  // "pending"    → Хүргэгч оноогдоогүй
  // "assigned"   → Хүргэгчид оноогдсон
  // "picked_up"  → Хүргэгч ачааг авсан
  // "in_transit" → Замдаа
  // "delivered"  → Хүргэгдсэн
  // "failed"     → Амжилтгүй (хэн ч байхгүй, буруу хаяг г.м.)
  // "returned"   → Буцаагдсан
  
  // Хугацаа
  assignedAt: Timestamp,
  pickedUpAt: null,
  deliveredAt: null,
  scheduledTime: null,         // Тодорхой цагт хүргэх
  
  // Баталгаа (Proof of Delivery)
  proof: {
    photo: null,               // Хүргэлтийн зураг
    signature: null,           // Гарын үсэг (canvas)
    receiverName: null,        // Хүлээн авагчийн нэр
    notes: null,               // Тэмдэглэл
  },
  
  // Амжилтгүй бол
  failureReason: null,
  // "not_home" | "wrong_address" | "refused" | "unreachable" | "other"
  failureNote: null,
  
  // Төлбөр
  deliveryFee: 5000,
  codAmount: 0,                // Cash on Delivery (хүргэгчээр төлбөр авах)
  codCollected: false,
  
  // Мета
  priority: "normal",         // "normal" | "urgent" | "scheduled"
  notes: "4-р давхар, цонхоор дуудна",
  createdBy: "user_xyz",
  createdAt: Timestamp,
  updatedAt: Timestamp,
}
```

---

## 4. ХҮРГЭЛТИЙН БҮС / ТӨЛБӨР

```javascript
// businesses/{bizId}/deliveryZones/{zoneId}
{
  id: "zone_bzd",
  name: "БЗД",
  fee: 5000,                  // Хүргэлтийн төлбөр
  estimatedTime: 30,          // Дундаж хугацаа (минут)
  isActive: true,
}
// Тохиргоо: settings.delivery.defaultFee = 5000
// Тохиргоо: settings.delivery.freeDeliveryThreshold = 100000 (100K+ бол үнэгүй)
```

---

## 5. ХҮРГЭЛТИЙН ДЭЛГЭЦ

### Хүргэлтийн жагсаалт (Менежер)
```
┌──────────────────────────────────────────┐
│  🚚 Хүргэлт                             │
│  [Бүгд] [Хүлээгдэж] [Замдаа] [Хүргэсэн]│
├──────────────────────────────────────────┤
│  Хүргэгч: Түмэн 🟢 (3/20)              │
│  ┌────────────────────────────────────┐  │
│  │ #0042 Болд • БЗД            🟡    │  │
│  │ iPhone 15 Pro x2 • ₮9M           │  │
│  │ 📍 3-р хороо, 45-р байр          │  │
│  └────────────────────────────────────┘  │
│  ┌────────────────────────────────────┐  │
│  │ #0043 Сараа • ХУД            🔵   │  │
│  │ Galaxy S24 x1 • ₮3.2M            │  │
│  └────────────────────────────────────┘  │
│                                          │
│  Хүргэгч: Ганаа 🟢 (1/20)              │
│  ┌────────────────────────────────────┐  │
│  │ #0044 Дорж • СБД            🟢    │  │
│  │ AirPods x3 • ₮1.5M               │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

### Хүргэгчийн дэлгэц (Mobile)
```
┌──────────────────────────────────┐
│  🚚 Миний хүргэлтүүд (3)        │
│                                  │
│  ┌────────────────────────────┐  │
│  │ 🔴 ЯАРАЛТАЙ               │  │
│  │ #0042 Болд 8800-1234       │  │
│  │ ₮9,000,000 • COD: ₮2M    │  │
│  │ БЗД, 3-р хороо, 45-р байр │  │
│  │ [📞 Залгах] [🗺️ Газрын зураг]│
│  │ [✅ Хүргэсэн] [❌ Амжилтгүй]│
│  └────────────────────────────┘  │
│                                  │
│  ┌────────────────────────────┐  │
│  │ 📦 #0043 Сараа             │  │
│  │ ₮3,200,000                │  │
│  │ ХУД, 15-р хороо            │  │
│  │ [📞] [🗺️] [✅] [❌]       │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘
```

---

## 6. ХҮРГЭЛТИЙН БАТАЛГАА (Proof of Delivery)
```
Хүргэгч "Хүргэсэн" дарахад:
┌──────────────────────────────┐
│  ✅ Хүргэлт баталгаажуулах   │
│                              │
│  📷 Зураг авах *             │
│  ┌────────────┐              │
│  │   📸       │              │
│  └────────────┘              │
│                              │
│  Хүлээн авагч:               │
│  [Болд             ]         │
│                              │
│  Тэмдэглэл:                 │
│  [Хүүхдэд нь өгсөн ]        │
│                              │
│  COD: ₮2,000,000 авсан      │
│  ☑ Бэлэн мөнгө авсан       │
│                              │
│  [     Баталгаажуулах     ]  │
└──────────────────────────────┘
```

---

## 7. ТАЙЛАН

| # | Тайлан | Агуулга |
|---|--------|---------|
| 1 | Хүргэлтийн нэгтгэл | Нийт, амжилттай, амжилтгүй |
| 2 | Хүргэгч бүрийн гүйцэтгэл | Хүргэсэн тоо, дундаж хугацаа |
| 3 | Бүс бүрийн хүргэлт | Аль бүсэд хамгийн их |
| 4 | Дундаж хүргэх хугацаа | Бүсээр, хүргэгчээр |
| 5 | COD тооцоо | Хүргэгчээр цуглуулсан мөнгө |
| 6 | Амжилтгүй хүргэлт | Шалтгаанаар нэгтгэсэн |

---

## 8. ЭРХҮҮД

| Permission ID | Нэр |
|---------------|------|
| `delivery.view_all` | Бүх хүргэлт харах |
| `delivery.view_own` | Зөвхөн өөрийн |
| `delivery.assign` | Хүргэгчид оноох |
| `delivery.update_status` | Статус солих |
| `delivery.manage_zones` | Бүс удирдах |
| `delivery.manage_drivers` | Хүргэгч удирдах |
| `delivery.collect_cod` | COD мөнгө авах |
| `delivery.view_reports` | Тайлан |

---

*7 дэд модуль, 6 тайлан, 8 эрх.*
