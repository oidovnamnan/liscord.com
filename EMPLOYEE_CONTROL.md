# 👁️ LISCORD — АЖИЛЧДЫН ХЯНАЛТ, АЛДАА СЭРГИЙЛЭХ & АВТОМАТЖУУЛАЛТ

---

## 1. 📜 АУДИТ ЛОГ (Бүх үйлдлийн бүртгэл)

> **Зарчим:** Системд хийгдсэн **БҮХ** үйлдэл — хэн, хэзээ, юу хийсэн — бүртгэгдэнэ.
> Устгаж, өөрчилж болохгүй. Эзэн/менежер хүссэн үедээ харна.

### 1.1 Бүртгэгдэх үйлдлүүд

| # | Үйлдэл | Юу хадгалагдах |
|---|---------|----------------|
| 1 | Захиалга үүсгэсэн | Хэн, хэдэн цагт, ямар захиалга, дүн |
| 2 | Захиалга засасан | Хэн, юуг юу болгож өөрчилсөн (хуучин→шинэ утга) |
| 3 | Захиалга устгасан | Хэн, PIN оруулсан уу, ямар захиалга |
| 4 | Статус өөрчилсөн | Хэн, хуучин→шинэ статус |
| 5 | Төлбөр бүртгэсэн | Хэн, хэдий, аль данс, ямар арга |
| 6 | Төлбөр засасан | Хэн, юуг өөрчилсөн |
| 7 | Буцаалт хийсэн | Хэн, хэдий, шалтгаан, аль данснаас |
| 8 | Харилцагч нэмсэн/засасан/устгасан | Хэн, ямар өөрчлөлт |
| 9 | Бараа нэмсэн/засасан/устгасан | Хэн, ямар өөрчлөлт |
| 10 | Барааны үнэ өөрчилсөн | Хэн, хуучин→шинэ үнэ |
| 11 | Нөөцийн тоо өөрчилсөн | Хэн, хуучин→шинэ тоо, шалтгаан |
| 12 | Хөнгөлөлт олгосон | Хэн, хэдэн %, ямар захиалганд |
| 13 | Нэвтэрсэн / Гарсан | Хэн, хэдэн цагт, ямар төхөөрөмжөөс |
| 14 | Тохиргоо өөрчилсөн | Хэн, юуг өөрчилсөн |

### 1.2 Мэдээллийн бүтэц

```javascript
// Firestore: businesses/{bizId}/activityLog/{logId}
{
  id: "log_abc123",
  
  // Хэн
  userId: "user_dorj",
  userName: "Дорж",
  userPosition: "Менежер",
  
  // Юу
  action: "order.update",              // Доор бүх action кодууд
  module: "orders",                     // orders | customers | products | payments | settings | auth
  
  // Ямар обьект дээр
  targetType: "order",                  // order | customer | product | transaction | position | employee
  targetId: "ord_xyz",
  targetLabel: "#ORD-0042",             // Хүн уншиж ойлгох нэр
  
  // Өөрчлөлтийн дэлгэрэнгүй
  changes: [
    {
      field: "status",
      fieldLabel: "Статус",
      oldValue: "new",
      oldLabel: "Шинэ",
      newValue: "confirmed",
      newLabel: "Баталсан"
    },
    {
      field: "items[0].quantity",
      fieldLabel: "iPhone 15 Pro — Тоо ширхэг",
      oldValue: 2,
      newValue: 3
    }
  ],
  
  // Нэмэлт мэдээлэл
  metadata: {
    ipAddress: "192.168.1.100",
    device: "iPhone 14 / Safari",
    pinUsed: false,                     // PIN ашигласан уу
    approvedBy: null                    // Зөвшөөрөл шаардсан бол хэн зөвшөөрсөн
  },
  
  // Ангилал
  severity: "normal",                   // "normal" | "warning" | "critical"
  // warning: Хөнгөлөлт олгосон, үнэ өөрчилсөн
  // critical: Устгасан, буцаалт, тохиргоо өөрчилсөн
  
  createdAt: Timestamp
}
```

### 1.3 Идэвхжилийн лог дэлгэц

```
┌──────────────────────────────────────────┐
│  📜 Идэвхжилийн лог                     │
│                                          │
│  Шүүлтүүр:                               │
│  Ажилтан: [▾ Бүгд]  Модуль: [▾ Бүгд]   │
│  Огноо: [02.20] — [02.22]               │
│  Чухал: [▾ Бүгд / Анхааруулга / Чухал]  │
│                                          │
│  ── Өнөөдөр ─────────────────────────── │
│                                          │
│  🔴 23:45 Дорж (Менежер)                │
│  Захиалга устгасан #ORD-0038            │
│  PIN ашигласан: Тийм                     │
│                                          │
│  🟡 22:30 Дорж (Менежер)                │
│  Барааны үнэ өөрчилсөн                  │
│  iPhone 15 Pro: ₮4,500,000 → ₮4,200,000│
│                                          │
│  ⚪ 21:15 Сараа (Нярав)                 │
│  Нөөцийн тоо өөрчилсөн                  │
│  Galaxy S24: 15 → 12 (3 ширхэг зарсан)  │
│                                          │
│  ⚪ 20:00 Бат (Эзэн)                    │
│  Захиалга үүсгэсэн #ORD-0042           │
│  Болд • ₮8,555,000 • 2 бараа            │
│                                          │
│  ⚪ 19:45 Дорж (Менежер)                │
│  Нэвтэрсэн                              │
│  iPhone 14 / Safari                      │
│                                          │
│  [Цааш харах...]                         │
└──────────────────────────────────────────┘
```

---

## 2. ⚠️ АЛДАА УРЬДЧИЛАН СЭРГИЙЛЭХ МЕХАНИЗМ

### 2.1 Оруулалтын хяналт (Input Validation)

| # | Хаана | Шалгалт | Алдаа мессеж |
|---|-------|---------|-------------|
| 1 | Захиалга — тоо ширхэг | > 0, бүхэл тоо, нөөцөөс ихгүй | "Нөөцөд 5 ширхэг л байна" |
| 2 | Захиалга — үнэ | > 0, тоо | "Зөв үнэ оруулна уу" |
| 3 | Захиалга — утас | +976 формат, 8 оронтой | "Утасны дугаар буруу байна" |
| 4 | Төлбөр — дүн | > 0, үлдэгдлээс ихгүй | "Үлдэгдэл ₮1.7M, илүү төлбөр бүртгэж болохгүй" |
| 5 | Төлбөр — данс | Заавал сонгосон байх | "Данс сонгоно уу" |
| 6 | Буцаалт — дүн | > 0, төлсөн дүнгээс ихгүй | "Төлсөн дүнгээс их буцааж болохгүй" |
| 7 | Бараа — нэр | Хоосон биш, давтагдаагүй | "Ижил нэртэй бараа байна" |
| 8 | Бараа — үнэ | > 0 | "Зөв үнэ оруулна уу" |
| 9 | Хөнгөлөлт — хувь | 0-100 хооронд | "Хөнгөлөлт 100%-аас хэтэрч болохгүй" |
| 10 | Нөөц — тоо | >= 0, бүхэл тоо | "Нөөц сөрөг байж болохгүй" |

### 2.2 Баталгаажуулалтын шатлал (Confirmation Levels)

```
Түвшин 1: Автомат (баталгаажуулалт шаардахгүй)
├── Захиалга харах
├── Хайлт хийх
├── Тэмдэглэл нэмэх

Түвшин 2: Нэг товшилт баталгаа
├── Захиалга үүсгэх → "Хадгалах уу?"
├── Статус өөрчлөх → "Шинэ → Баталсан руу шилжүүлэх үү?"
├── Харилцагч нэмэх
├── Бараа нэмэх

Түвшин 3: Хоёр алхамт баталгаа
├── Захиалга засах → "Өөрчлөлтүүд: ... Хадгалах уу?"
├── Төлбөр бүртгэх → Мэдээлэл харуулах → "Баталгаажуулах уу?"
├── Үнэ өөрчлөх → Хуучин/шинэ харьцуулалт → "Баталгаажуулах уу?"

Түвшин 4: PIN баталгаажуулалт
├── Захиалга устгах → "Итгэлтэй байна уу?" → PIN оруулах
├── Буцаалт хийх → Мэдээлэл → PIN оруулах
├── Бөөнөөр устгах → PIN
├── Ажилтан хасах → PIN

Түвшин 5: Эзний зөвшөөрөл (Approval flow)
├── Тодорхой дүнгээс дээш хөнгөлөлт → Эзний зөвшөөрөл хэрэгтэй
├── Тодорхой дүнгээс дээш буцаалт → Эзний зөвшөөрөл
├── Тохиргоо өөрчлөх → Эзний зөвшөөрөл
```

### 2.3 Хязгаарлалтууд (Ажилтан бүрт)

```javascript
// businesses/{bizId} → settings.employeeLimits
{
  employeeLimits: {
    // Хөнгөлөлтийн хязгаар
    maxDiscountPercent: 10,            // Ажилтан хамгийн ихдээ 10% хөнгөлөлт өгч болно
    maxDiscountPercentManager: 20,     // Менежер 20% хүртэл
    discountAboveNeedsApproval: 15,    // 15%-аас дээш → эзний зөвшөөрөл
    
    // Буцаалтын хязгаар
    maxRefundAmount: 500000,           // Ажилтан ₮500,000 хүртэл буцаалт хийж болно
    maxRefundAmountManager: 5000000,   // Менежер ₮5M хүртэл
    refundAboveNeedsApproval: 1000000, // ₮1M-аас дээш → эзний зөвшөөрөл
    
    // Үнийн хязгаар
    canChangePrice: false,             // Ажилтан үнэ өөрчлөх эсэх
    maxPriceChangePercent: 5,          // Хамгийн ихдээ 5%-аар өөрчлөх (менежер)
    
    // Устгалын хязгаар
    canDeleteOrders: false,            // Зөвхөн PIN + эрхтэй хүн
    canBulkDelete: false,              // Бөөнөөр устгах (зөвхөн эзэн)
    
    // Цагийн хязгаар
    orderEditWindow: 60,               // Захиалга үүсгэснээс 60 минутын дотор засаж болно
    // Дараа нь менежер/эзэн л засна
    
    // Нөөцийн хязгаар
    maxStockAdjustment: 50,            // Нэг удаад 50-аас дээш нөөц өөрчилбөл анхааруулга
  }
}
```

### 2.4 Ухаалаг анхааруулгууд (Smart Warnings)

| # | Нөхцөл | Анхааруулга | Энэ юу сэргийлэх вэ |
|---|--------|-------------|---------------------|
| 1 | Захиалгын дүн ₮0 | "Дүн ₮0 байна. Үнэ оруулсан уу?" | Үнэ мартсан |
| 2 | Хөнгөлөлт > 20% | "Хөнгөлөлт 25% байна. Итгэлтэй юу?" 🟡 | Хэт их хөнгөлөлт |
| 3 | Нөөцөөс их зарах | "Нөөцөд 3 байна, 5 захиалж байна" 🔴 ХОРИГЛОХ | Нөөцгүй бараа зарах |
| 4 | Ижил харилцагч, ижил бараа, ижил өдөр | "Болд-д iPhone 15 өнөөдөр захиалсан. Давхардсан уу?" 🟡 | Давхар захиалга |
| 5 | Төлбөр > Үлдэгдэл | "Үлдэгдэл ₮1.7M, ₮2M бүртгэж байна" 🔴 ХОРИГЛОХ | Илүү төлбөр |
| 6 | Буцаалт > Төлсөн | "Төлсөн ₮7M, ₮8M буцааж байна" 🔴 ХОРИГЛОХ | Илүү буцаалт |
| 7 | Барааны үнэ 50%+ өөрчлөгдсөн | "Үнэ 50%-аар буурсан. Итгэлтэй юу?" 🟡 | Буруу үнэ оруулах |
| 8 | 1 цагт 10+ устгалт | "Олон устгалт хийгдэж байна" 🔴 ЭЗЭНД МЭДЭГДЭЛ | Хорлонт үйлдэл |
| 9 | Ажлын бус цагт нэвтрэх | "23:45 цагт нэвтэрсэн" 🟡 ЭЗЭНД МЭДЭГДЭЛ | Сэжигтэй нэвтрэлт |
| 10 | Шинэ төхөөрөмжөөс нэвтрэх | "Шинэ төхөөрөмж: Samsung Galaxy S25" 🟡 | Бусад хүн нэвтрэх |

### 2.5 Буцаах боломж (Undo)

| Үйлдэл | Буцаах боломж | Хугацаа |
|---------|-------------|---------|
| Захиалга үүсгэсэн | ✅ Устгах (PIN-тэй) | Хязгааргүй |
| Захиалга засасан | ✅ Хуучин утга руу буцаах (log-оос) | Хязгааргүй |
| Захиалга устгасан | ✅ Soft delete → Сэргээх боломжтой | 30 хоног |
| Статус өөрчилсөн | ✅ Өмнөх статус руу буцаах | Хязгааргүй |
| Төлбөр бүртгэсэн | ✅ Төлбөр цуцлах | 24 цаг (дараа нь эзэн л) |
| Буцаалт хийсэн | ❌ Буцааж болохгүй | — |
| Бараа устгасан | ✅ Soft delete → Сэргээх | 30 хоног |
| Харилцагч устгасан | ✅ Soft delete → Сэргээх | 30 хоног |

---

## 3. 🤖 АВТОМАТЖУУЛАЛТ

### 3.1 Захиалгын автоматжуулалт

| # | Автомат | Тайлбар |
|---|---------|---------|
| 1 | **Дугаар** | ORD-0001 → ORD-0002 автомат, давтагдахгүй |
| 2 | **Үнэ** | Каталогоос бараа сонгоход үнэ автомат бөглөгдөнө |
| 3 | **Нийт дүн** | тоо × үнэ = нийт (real-time тооцоолно) |
| 4 | **Хөнгөлөлт** | Хөнгөлөлтийн дүн автомат тооцоолно |
| 5 | **Төлбөрийн статус** | Төлбөр бүртгэхэд: unpaid → partial → paid автомат |
| 6 | **Нөөц хасах** | Захиалга баталгаажахад нөөцөөс автомат хасна |
| 7 | **Нөөц нэмэх** | Буцаалт хийхэд нөөцөд автомат нэмнэ (хэрэв сонгосон бол) |
| 8 | **Харилцагчийн стат** | Захиалга бүрт: totalOrders++, totalSpent += дүн |
| 9 | **Шатлал үнэ** | Бөөний: 10+ сонговол шатлал үнэ автомат хэрэглэгдэнэ |
| 10 | **Валют хөрвүүлэлт** | CNY → MNT тохируулсан ханшаар автомат |
| 11 | **Хүргэлтийн төлбөр** | Дүүргээс хамааран хүргэлтийн төлбөр автомат |

### 3.2 Статус автоматжуулалт

| # | Триггер | Автомат үйлдэл |
|---|---------|----------------|
| 1 | Захиалга үүсэхэд | Статус → "Шинэ", мэдэгдэл → бүх хүлээн авагч |
| 2 | Бүрэн төлбөр авахад | Статус → "Баталсан" (тохируулсан бол) |
| 3 | Бүх бараа бэлэн болоход | Статус → "Бэлэн" (тохируулсан бол) |
| 4 | Статус "Хүргэгдсэн" болоход | Харилцагчид мэдэгдэл |
| 5 | 24 цаг хариу ирээгүй шинэ захиалга | Анхааруулга → ажилтанд |
| 6 | Хүргэлтийн огноо өнгөрсөн | Анхааруулга → менежерт |

### 3.3 Мэдэгдлийн автоматжуулалт

| # | Нөхцөл | Хэнд | Мэдэгдэл |
|---|--------|------|----------|
| 1 | Шинэ захиалга | receive_new_order эрхтэй бүгд | "Шинэ захиалга #0042 — Болд ₮8.5M" |
| 2 | Статус өөрчлөгдсөн | receive_status_change | "#0042 Шинэ → Баталсан (Дорж)" |
| 3 | Төлбөр бүртгэгдсэн | receive_payment | "#0042 ₮5M төлбөр — Хаан банк (Бат)" |
| 4 | Нөөц доод хязгаарт | receive_low_stock | "⚠️ iPhone 15 Pro — 2 ширхэг үлдсэн" |
| 5 | Буцаалт хийгдсэн | receive_payment | "🔙 #0042 ₮4.5M буцаалт (Дорж)" |
| 6 | Авлага хугацаа хэтрэх гэж байна | receive_payment | "⏰ Болд ₮1.7M — 3 хоног үлдсэн" |
| 7 | Авлага хугацаа хэтэрсэн | receive_payment + эзэн | "🔴 Болд ₮1.7M — хугацаа хэтэрсэн!" |
| 8 | ⚠️ Сэжигтэй үйлдэл | Эзэн | "⚠️ Дорж 1 цагт 8 захиалга устгасан" |
| 9 | ⚠️ Сэжигтэй нэвтрэлт | Эзэн | "⚠️ Сараа шинэ төхөөрөмжөөс нэвтэрсэн" |
| 10 | Ажилтан урилга зөвшөөрсөн | Эзэн + team.view | "✅ Дорж урилга зөвшөөрч нэгдсэн" |

### 3.4 Тохируулж болох автомат дүрмүүд (Rules Engine)

Эзэн тохиргооноос **автомат дүрэм** тохируулж болно:

```
Дүрэм 1: "Бүрэн төлбөр авахад статус автомат Баталсан болно"
  ХЭРЭВ: paymentStatus = "paid"
  БОЛ: status → "confirmed"

Дүрэм 2: "₮5M-аас дээш захиалгад 3% хөнгөлөлт автомат"
  ХЭРЭВ: totalAmount >= 5000000
  БОЛ: discount = 3%

Дүрэм 3: "VIP харилцагчийн захиалга автомат баталгаажна"
  ХЭРЭВ: customer.tags includes "vip"
  БОЛ: status → "confirmed"

Дүрэм 4: "Хүргэлтийн хаяг БЗД → төлбөр ₮3000"
  ХЭРЭВ: delivery.district = "БЗД"
  БОЛ: deliveryFee = 3000
```

---

## 4. 🔒 ЗӨВШӨӨРЛИЙН СИСТЕМ (Approval Workflow)

### 4.1 Зөвшөөрөл шаардах нөхцлүүд

| # | Нөхцөл | Хэнээс зөвшөөрөл | Тайлбар |
|---|--------|------------------|---------|
| 1 | Хөнгөлөлт > X% | Эзэн / Менежер | X%-ийг тохиргооноос тохируулна |
| 2 | Буцаалт > ₮Y | Эзэн | Y дүнг тохиргооноос |
| 3 | Захиалга устгах | PIN + Эрхтэй хүн | PIN заавал |
| 4 | Бөөнөөр устгах | Эзэн | Зөвхөн эзэн PIN-тэй |
| 5 | Барааны үнэ өөрчлөх | Менежер+ | Ажилтан хийж чадахгүй |
| 6 | Бизнесийн тохиргоо | Эзэн | Зөвхөн эзэн |
| 7 | Ажилтны тушаал өөрчлөх | Эзэн | Зөвхөн эзэн |

### 4.2 Зөвшөөрлийн мэдээллийн бүтэц

```javascript
// Firestore: businesses/{bizId}/approvalRequests/{requestId}
{
  id: "apr_abc",
  type: "discount_override",          // discount_override | refund_override | price_change | deletion
  
  // Хүсэлт гаргагч
  requestedBy: "user_dorj",
  requestedByName: "Дорж",
  requestedAt: Timestamp,
  
  // Контекст
  context: {
    orderId: "ord_xyz",
    orderNumber: "ORD-0042",
    currentDiscount: 10,
    requestedDiscount: 25,
    reason: "VIP харилцагч, урт хугацааны хамтрагч"
  },
  
  // Шийдвэр
  status: "pending",                   // "pending" | "approved" | "rejected"
  decidedBy: null,
  decidedByName: null,
  decidedAt: null,
  decisionNote: null,
  
  expiresAt: Timestamp                 // 24 цагийн дараа дуусна
}
```

### 4.3 Зөвшөөрлийн дэлгэц (Эзний)

```
┌──────────────────────────────────────────┐
│  🔔 Мэдэгдэл                            │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │ 🟡 Зөвшөөрөл хүсэлт              │  │
│  │ Дорж 25% хөнгөлөлт хүсэж байна   │  │
│  │ #ORD-0042 • Болд • ₮8,555,000    │  │
│  │ Шалтгаан: "VIP харилцагч"         │  │
│  │                                    │  │
│  │ Хөнгөлөлт: 10% → 25%             │  │
│  │ Зөрүү: ₮1,283,250                │  │
│  │                                    │  │
│  │ [✅ Зөвшөөрөх]  [❌ Татгалзах]   │  │
│  │                                    │  │
│  │ Тайлбар: [________________]       │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

---

## 5. 📊 АЖИЛТНЫ ГҮЙЦЭТГЭЛИЙН ТАЙЛАН

### 5.1 Ажилтан бүрийн KPI

```
┌──────────────────────────────────────────┐
│  👔 Дорж (Менежер) — Гүйцэтгэл          │
│  Хугацаа: Энэ сар (02.01 - 02.22)       │
│                                          │
│  ── Захиалга ────────────────────────── │
│  Үүсгэсэн:          45 захиалга        │
│  Статус өөрчилсөн:   120 удаа           │
│  Засасан:            12 удаа            │
│  Устгасан:           2 удаа             │
│                                          │
│  ── Борлуулалт ──────────────────────── │
│  Нийт дүн:           ₮32,500,000       │
│  Дундаж захиалга:    ₮722,222          │
│  Хамгийн том:        ₮5,200,000        │
│                                          │
│  ── Төлбөр ──────────────────────────── │
│  Бүртгэсэн:         ₮28,000,000       │
│  Буцаалт:            ₮1,500,000        │
│                                          │
│  ── Хөнгөлөлт ──────────────────────── │
│  Олгосон:            8 удаа            │
│  Нийт хөнгөлөлт:    ₮850,000          │
│  Дундаж хөнгөлөлт:  6.2%              │
│                                          │
│  ── Идэвхжил ────────────────────────── │
│  Нийт нэвтэрсэн:    18 өдөр / 22       │
│  Дундаж онлайн:      6.5 цаг / өдөр    │
│  Сүүлд идэвхтэй:    2 цагийн өмнө     │
│                                          │
│  ── Анхааруулга ─────────────────────── │
│  ⚠️ 2 удаа хөнгөлөлтийн хязгаар       │
│     хүрсэн (эзний зөвшөөрөл хүссэн)    │
│  ⚠️ 1 удаа ажлын бус цагт нэвтэрсэн   │
│                                          │
│  [📥 Тайлан татах (PDF)]               │
└──────────────────────────────────────────┘
```

### 5.2 Ажилтнуудын харьцуулалт

```
┌──────────────────────────────────────────┐
│  📊 Ажилтнуудын харьцуулалт (Энэ сар)   │
│                                          │
│  ── Захиалга үүсгэсэн ─────────────── │
│  Бат (Эзэн):    68  ████████████████   │
│  Дорж (Менежер): 45  ██████████         │
│  Сараа (Нярав):  12  ███                │
│                                          │
│  ── Борлуулалтын дүн ──────────────── │
│  Бат:    ₮48,200,000  ████████████████ │
│  Дорж:   ₮32,500,000  ██████████       │
│  Сараа:  ₮8,100,000   ███              │
│                                          │
│  ── Хөнгөлөлт олгосон (%) ─────────── │
│  Сараа:  2.1%   ██                      │
│  Бат:    4.5%   ████                    │
│  Дорж:   6.2%   ██████  ← Хамгийн их  │
│                                          │
│  ── Устгалт хийсэн ───────────────── │
│  Бат:    5 удаа                         │
│  Дорж:   2 удаа                         │
│  Сараа:  0 удаа                         │
└──────────────────────────────────────────┘
```

---

## 6. 🕐 АЖИЛТНЫ ОНЛАЙН СТАТУС

### 6.1 Бодит цагийн хяналт

```javascript
// Firestore: businesses/{bizId}/presence/{userId}
{
  userId: "user_dorj",
  name: "Дорж",
  position: "Менежер",
  
  status: "online",                     // "online" | "away" | "offline"
  lastSeen: Timestamp,
  lastAction: "Захиалга #0042 засасан",
  
  session: {
    loginAt: Timestamp,
    device: "iPhone 14 / Safari",
    ipAddress: "192.168.1.100"
  }
}
```

### 6.2 Хэн онлайн байгаа дэлгэц

```
┌──────────────────────────────────┐
│  Sidebar-ийн доод хэсэг:         │
│                                  │
│  👥 Баг (3/5 онлайн)             │
│  🟢 Бат (Эзэн) — Одоо           │
│  🟢 Дорж (Менежер) — 5 мин       │
│  🟡 Сараа (Нярав) — 30 мин       │
│  ⚫ Оюуна (Хүргэгч) — 3 цаг     │
│  ⚫ Энхээ (Бүртгэгч) — Өчигдөр  │
└──────────────────────────────────┘
```

---

## 7. 🛡️ НЭМЭЛТ ХАМГААЛАЛТ

### 7.1 Цагийн хязгаарлалт (Тохируулж болно)

```javascript
settings: {
  workHours: {
    enabled: false,                    // Ажлын цагийн хязгаарлалт
    start: "09:00",
    end: "20:00",
    timezone: "Asia/Ulaanbaatar",
    allowOutsideHours: false,          // false бол ажлын бус цагт нэвтрэж чадахгүй
    notifyOwnerOutsideHours: true      // Ажлын бус цагт нэвтэрвэл эзэнд мэдэгдэнэ
  }
}
```

### 7.2 Төхөөрөмжийн хязгаарлалт

```javascript
settings: {
  deviceLimit: {
    maxDevicesPerEmployee: 2,          // Нэг ажилтан хамгийн ихдээ 2 төхөөрөмжөөс
    notifyNewDevice: true,             // Шинэ төхөөрөмжөөс нэвтрэхэд мэдэгдэнэ
    requireApprovalNewDevice: false    // Шинэ төхөөрөмж зөвшөөрөл шаардах уу
  }
}
```

### 7.3 Сэжигтэй үйлдлүүдийн бодит цагийн илрүүлэлт

| # | Илрүүлэх | Хариу үйлдэл |
|---|----------|-------------|
| 1 | 1 цагт 5+ устгалт | 🔴 Эзэнд push мэдэгдэл + аудит лог |
| 2 | 5 минутад 20+ засвар | 🟡 Эзэнд мэдэгдэл |
| 3 | Ижил захиалга 3+ удаа засвар | 🟡 Анхааруулга |
| 4 | Ажлын бус цагт нэвтрэлт | 🟡 Мэдэгдэл |
| 5 | Шинэ IP/төхөөрөмж | 🟡 Мэдэгдэл |
| 6 | Олон удаа PIN буруу оруулсан | 🔴 Түр хаах + мэдэгдэл |
| 7 | Зөвшөөрөлгүй хуудас руу орох оролдлого | 🟡 Лог + мэдэгдэл |

---

## 8. 📱 ЭЗНИЙ ХЯНАЛТЫН САМБАР (Owner Dashboard)

```
┌──────────────────────────────────────────┐
│  👁️ Хяналт (Эзний тусгай хэсэг)        │
├──────────────────────────────────────────┤
│                                          │
│  ── Өнөөдрийн тойм ─────────────────── │
│  Нийт үйлдэл:      156                 │
│  Захиалга үүсгэсэн: 24                  │
│  Төлбөр бүртгэсэн:  ₮12,500,000       │
│  Буцаалт:           ₮500,000 (2 удаа)  │
│  Устгалт:           3 удаа              │
│                                          │
│  ── ⚠️ Анхаарах ─────────────────────── │
│  🟡 Дорж 25% хөнгөлөлт → Зөвшөөрөх?   │
│  🟡 Сараа шинэ төхөөрөмжөөс нэвтэрсэн │
│  🔴 2 зөвшөөрлийн хүсэлт хүлээгдэж буй │
│                                          │
│  ── Ажилтан бүрийн өнөөдрийн тойм ──── │
│                                          │
│  👔 Дорж (Менежер) 🟢 Онлайн            │
│  ├── 12 захиалга үүсгэсэн              │
│  ├── ₮8,200,000 төлбөр бүртгэсэн       │
│  ├── 1 буцаалт (₮500,000)              │
│  ├── 2 хөнгөлөлт (дундаж 8%)           │
│  └── ❗ 1 зөвшөөрлийн хүсэлт           │
│                                          │
│  📦 Сараа (Нярав) 🟡 30 мин             │
│  ├── 3 бараа нэмсэн                    │
│  ├── 8 удаа нөөц өөрчилсөн             │
│  └── ✅ Анхааруулга байхгүй             │
│                                          │
│  🚚 Оюуна (Хүргэгч) ⚫ 3 цаг           │
│  ├── 5 захиалга "Хүргэгдсэн" болгосон  │
│  └── ✅ Анхааруулга байхгүй             │
│                                          │
│  [📜 Бүх лог харах →]                   │
│  [📊 Ажилтны тайлан →]                  │
└──────────────────────────────────────────┘
```

---

## 9. 🔑 ШИНЭ ЭРХҮҮД (Хяналтын модулийн)

| Эрхийн ID | Нэр | Тайлбар |
|-----------|-----|---------|
| `audit.view_own` | Өөрийн лог | Зөвхөн өөрийн үйлдлүүдийн лог |
| `audit.view_all` | Бүх лог | Бүх ажилтнуудын лог |
| `audit.view_reports` | Гүйцэтгэлийн тайлан | Ажилтнуудын гүйцэтгэл |
| `approval.decide` | Зөвшөөрөл шийдвэрлэх | Хүсэлт зөвшөөрөх/татгалзах |
| `team.view_presence` | Онлайн статус | Хэн онлайн харах |
| `settings.manage_limits` | Хязгаарлалт тохируулах | Хөнгөлөлт, буцаалтын хязгаар |
| `settings.manage_rules` | Автомат дүрэм | Дүрэм тохируулах |

---

*Энэ модуль ажилчдын хяналтын бүрэн тогтолцоог хамарна.*
